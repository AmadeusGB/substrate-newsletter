# 2022.02 - Substrate 技术更新速递

## 重要提交和发布

1. [默认执行策略改为 Wasm #11170 ](https://github.com/paritytech/substrate/pull/11170) runtime的默认执行策略从`NativeElseWasm` 改为`Wasm`,  至此`native`的执行策略基本已经弃用, 但仍然保留此选项, 只是不再是默认策略.
   
   
2. [Add 增加 `benchmark-overhead` 子命令 #10977 ](https://github.com/paritytech/substrate/pull/10977) 该子命令会构建一个空区块和一个完整区块, 并计算它们的区块和extrinsic的overhead开销, 计算结束后生成两个权重文件(带虚拟值): [block_weights.rs.txt](https://github.com/paritytech/substrate/files/8219022/block_weights.rs.txt), [extrinsic_weights.rs.txt](https://github.com/paritytech/substrate/files/8219023/extrinsic_weights.rs.txt). 注: 该子命令在 [#11164](https://github.com/paritytech/substrate/pull/11164) 中并入 `benchmark` 统一子命令中, 见下文.
   
   
3. [增加 `benchmark-block` 命令 #11091](https://github.com/paritytech/substrate/pull/11091)  类似上个PR, 增设 `benchmark-block`命令, 用于衡量精度和基准测试, 该命令将区块执行时间和其消耗的权重进行比较. 具体调用方式可以通过`Blockcmd`的rust api文档查看.  未来可用于对区块24小时内的执行情况做监控, 以查看有那些区块`超重`. `benchmark`相关改进的后续进度移到[#11141](https://github.com/paritytech/substrate/issues/11141)中;  注: 该子命令在 [#11164](https://github.com/paritytech/substrate/pull/11164) 中并入 `benchmark` 统一子命令中, 见下文.
   
   
4. [ `benchmark-storage` 子命令增添3个flags](https://github.com/paritytech/substrate/pull/11004)  `benchmark-storage`现在可以使用 `--template-path`flag 来自定义 handlebars模板, 并可以使用`--json-read-path`和 `json-write-path`来读取和生成JSON格式文件.
   
   
5. [设置 benchmark 相关子命令 #11164](https://github.com/paritytech/substrate/pull/11164)  将原有的一系列分散的benckmark相关命令如`benchmark`, `benchmark-block`, `benchmark-storage` 和 `benchmark-overhead` 等, 统一放到`benchmark`子命令下,  使用方式如`susbstrate benchmark <SUBCOMMAND>`, 其中`<SUBCOMMAND>`可以为`block`, `overhead`, `pallet`, `storage`或者`help`; 更加简明易用.
   
   
6. [增加新的硬件和软件遥测指标信息 #11062](https://github.com/paritytech/substrate/pull/11062) 为遥测添加一些指标信息, 包括CPU/内存/磁盘速率等, 如果是Linux环境则还会有内核版本/发行版以及是否运行在虚拟机上等信息, 这些信息仅在节点启动时的1s内一次性收集完毕, 后续不会持续检测, 因此不会占用运行时资源.
   
   
7. [废弃 "`paritydb-experimental`"命令, 推荐使用paritydb #10975](https://github.com/paritytech/substrate/pull/10975)`paritydb-experimental`命令即将被废弃, 目前仍可以使用, 但使用时会提示`即将被废弃`, 增加`paritydb`命令, 推荐后续使用该命令.
   
   
8. [增加新的 dev_getBlockStats RPC接口 #10939](https://github.com/paritytech/substrate/pull/10939) 新的RPC接口用于收集链上瓶颈信息, 而无需通过获取区块大小和交易数量然后再计算的方式来获取.
   
   
9. [最终块确认通知: 优化stale heads的计算 #11200](https://github.com/paritytech/substrate/pull/11200)  由于最终确认块和最佳块之间存在相当数量的块叶子, 经常导致收集者(collator)出现卡顿, 现在对此优化了计算方式以减少此类问题.
   
   
10. [修复存储层限制 #11156](https://github.com/paritytech/substrate/pull/11156) 由于在本机运行时中，对runtime的多个不同调用可能同时发生在同一内存上, 因而存储层不再使用原子(Atomic)方式来计数
    
    
11. [重命名 bags-list pallet中一些类型和API #10997](https://github.com/paritytech/substrate/pull/10997) 将`SortedListProvider,` `pallet-bags_list::Config`, 和`VoteWeightProvider` 等重命名至 `ScoreProvider` 中, 相关接口API也做相应修改.
    
    
12. [稳定ink!的 `is_contract` 和 `caller_is_origin` 至'seal0\` #10971 ](https://github.com/paritytech/substrate/pull/10971) 后续`seal_is_contract` and `seal_caller_is_origin`添加至Ink!并完成测试后, 会正式稳定下来.
    
    
13. [添加 `WeightToFeePolynomial` 到 `pallet_transaction_payment` 的`LeghthToFee`中 #10785](https://github.com/paritytech/substrate/pull/10785)  通过添加`WeightToFeePolynomial`机制到`pallet_transaction_payment` 的 length fee中, 以增加更多灵活性, 主要是尝试去解决[#10784](https://github.com/paritytech/substrate/issues/10784), 后续针对此问题可能会做更多重大改进.
    
    
14. [#11037 智能合约: 稳定 `seal_delegate_call`](https://github.com/paritytech/substrate/pull/11037) 该方法已经通过测试, 现已稳定.
    
    
15. [改进赏金和子赏金质押逻辑#11014](https://github.com/paritytech/substrate/pull/11014)  以前的赏金机制不够灵活, 尤其对于需要有子赏金项的情况下来说更加. 现改进了相关逻辑, 可以设置上限和下限并子赏金项质押额与其父赏金项做了一些关联; 具体请见PR详情.
    
    
16. [为选举失败增加有界回退 #10988](https://github.com/paritytech/substrate/pull/10988) Polkadot 关联PR : [paritytech/polkadot#5093](https://github.com/paritytech/polkadot/pull/5093)  选举的风格类似于DPoS, 详细描述见[PR#10334](https://github.com/paritytech/substrate/issues/10334); 本次PR将`Fallback`类型修改为`InstantElectionProvider`, 在节点runtime中选举如果失败或者没有选出时, 增加一个有限定的fallback.
    
    
17. [Ink!合约增加  `seal_code_hash` 和 `seal_own_code_hash`  API #10933](https://github.com/paritytech/substrate/pull/10933)
    
    
18. [为 Transactional Layers 增加限制#10808](https://github.com/paritytech/substrate/pull/10808):   让`FRAME`可以设置一个"事务层级数 Transactional Layers", 默认值为`255`,  任何`with_transactional`的调用将返回一个`Result`, 同时提供`with_transactional_unchecked`来兼容之前的代码.   这次改动源于[#10806](https://github.com/paritytech/substrate/issues/10806)讨论提出了为FRAME 设置缺省的事务式存储, 并给出了具体设计思路,  一共包含有3个实现步骤, 本次PR完成了第一个.

## 设计方案和问题讨论

1. [增加 `benchmark machine` 命令占位符](https://github.com/paritytech/substrate/pull/11198): 该bechmark子命令主要用于测量部署节点的机器性能, 如CPU的SR25519 验证能力, 磁盘的随即写和顺序读, 内存复制速率等.
2. [aura, babe: 移除inherent相关代码](https://github.com/paritytech/substrate/pull/10906) `Aura`和`BABE`的`ProvideInherent`一年前就已经被移除, 相关代码应该一并移除.
3. [将 force_batch 添加到utility pallet #11148](https://github.com/paritytech/substrate/pull/11148)  为`utility` pallet添加 `force_batch` Call, 如果想要批量调用Call, 并可以忽略其中某些Call有调用失败的可能.
4. [Governance 的一些调整草稿 #111124](https://github.com/paritytech/substrate/pull/11124)
5. [为npos-election实现 MMS 算法 #11180](https://github.com/paritytech/substrate/pull/11180)  该算法相对较慢, 但结果会更好,.
6. [ 匿名代理账户V2 #1115 ](https://github.com/paritytech/substrate/pull/11115)   本提案希望对匿名代理其进行一些调整, 提高其可用性，使其成为在钱包中创建用户安全帐户时的首选
7. [添加 `frame_support::crypto::ecdsa::Public.to_eth_address()` (`k256`-based) 方法并使其可用于pallets #11087](https://github.com/paritytech/substrate/pull/11087) : 主要用于ECDSA 公钥到 ETH id 的转换

## 文档和资料

* [Substrate Seminar: Imbue network - crowdfunding DAO built with Substrate](https://youtu.be/xbjdhTO7VtA) Imbue Network 是一个建立在 Polkadot 生态内的去中心化众筹 与风险投资的DAO。 这是一个开放的创意孵化器，它允许任何人为任何类型的创意发起众筹, 也可以为喜欢的项目投票, 并让有价值的项目从信任者手中中获取投资. Imbue Network在今年2月份获得Web3.0 基金会赞助, 目前已经通过了Milestone 1阶段. 本次Senimar 邀请到Imbue Network的核心开发者&联合创始人Sam Elamin, Sam讲述了Imbue Network的立项动机, 宗旨和目标; 并现场演示了项目代码体系和UI界面, 以及后续的计划等等.

* [Ink!3.0 重磅更新](https://www.parity.io/blog/ink-3-0-paritys-rust-based-language-gets-a-major-update) Ink!是基于Rust的智能合约语言; 现在3.0版本已经发布, 此版本有许多重大更新和改进. 

* [XCM V2 完整审计报告](https://blog.quarkslab.com/resources/2022-02-27-xcmv2-audit/21-12-908-REP.pdf)

## 技术生态和社区

* [Substrate Evangelist Program 正式启动 & 开幕式](https://mp.weixin.qq.com/s/QoXcueo0fDMKYEjSbKFODw) Oneblock 联合 Parity 推出了 「Substrate Evangelist Program」计划，旨在尝试利用 DAO 的模式推动 Substrate 的技术推广和各项的合作拓展，帮助 Substrate 生态在技术创新和项目等层面实现更好的发展。
* [Web3.0 训练营2022期](https://bootcamp.web3.foundation/zh-cn.html#about)
* [Substrate Saturday 第九期-构建全新的去中心化加密存储方案 回放](https://youtu.be/U5Omsgc15eU)

## 跨链协议
* [Uniques pallet 改进和 XCM v3 准备 #10896 ](https://github.com/paritytech/substrate/pull/10896): `Uniques` 为基于substrate链构建NFT提供了基础设施, 本PR对其进行了改进, 新增了部分trait用以支持 XCM V3版
* [XCM v3: 支持 non-fungibles #4950](https://github.com/paritytech/polkadot/pull/4950): 基于substrate pr [#10896 ](https://github.com/paritytech/substrate/pull/10896), 为XCM/MultiAsset提供 `assets::nonfungible`trait以支持NFT, 并提供了一系列接口和机制.
* [XCM v2 的审计简述 ](https://mp.weixin.qq.com/s/xbvrYwyoeN9wrzSIuz028A)


