# 2022.01 - Substrate 技术更新速递

## 重要提交和发布

1. [Upgradable contracts using set_code function #10690](https://github.com/paritytech/substrate/pull/10690) 利用set_code实现可升级合约，确保相同合约以及存储的情况下，实现新合约代码的兼容性升级  

2. [Remove all stale on_runtime_upgrade hooks in the runtime #10650](https://github.com/paritytech/substrate/pull/10650) 删除contracts、offences、staking、uniques、vesting模块on_runtime_upgrade() hooks，这些hooks已经过时，删除将会使try-runtime更干净

3. [runtime-interface: Implement register_only functions](https://github.com/paritytech/substrate/pull/10640) runtime接口版本管理，目前如果新增一个函数，它会在runtime中自动运行，这使得网络中所有节点在runtime upgrade之前进行升级，register_only方法能够指定版本，使runtime编译为wasm时仍可使用该函数旧版本

4. [Add BEEFY latestFinalized RPC and deduplicate code between BEEFY and GRANDPA #10568](https://github.com/paritytech/substrate/pull/10568) 增加BEFFY RPC方法，用于获取最佳的beffy latestFinalized block；如果发生RPC垃圾邮件，避免在worker/node/gadget和RPC线程之间使用锁定机制避免DoS

5. [Fast/warp sync fixes #10562](https://github.com/paritytech/substrate/pull/10562) 修复Fast/warp同步时一些问题，主要与重启中断的快速同步相同。例如，当快速同步中断并重启节点时，Babe将从最新区块里读取配置，替代读取最新可用状态；重启快速同步时，DB将重新finalized创世区块等。

6. [paras: Add runtime events for PVF pre-checking #4683](https://github.com/paritytech/polkadot/pull/4683) paras模块添加3个事件：PvfCheckStarted、PvfCheckAccepted、PvfCheckRejected，每新增1个PVF，无论onboarding/upgrading或另一个parachain触发预检查，则会触发PvfCheckStarted事件；当PVF预检查投票完成后，PvfCheckAccepted/Rejected事件将被触发  

## 设计方案和问题讨论

1. [Fix PoV attack vector for contracts #10301](https://github.com/paritytech/substrate/issues/10301) athei 提出要加快修改 pov 的问题

2. [Enforce migrations to be standalone scripts #10308](https://github.com/paritytech/substrate/issues/10308) 现在 migration 是写在代码里的无用 code，需要单独出来做成 script

3. [Make the genesis block building more flexible #10360](https://github.com/paritytech/substrate/issues/10360) 有人想在 genesis 插入一个Digest，以此不是 pre-genesis 让用户无法猜到下个区块，以此引出这问题讨论

4. [https://github.com/paritytech/substrate/issues/10426](https://github.com/paritytech/substrate/issues/10426) 如何匿名在跨链传输交易，只要账号是匿名的就可以

5. [Consider changing inherent_extrinsics() to encode the extrinsics before returning them #10392](https://github.com/paritytech/substrate/issues/10392) 讨论 inherent_extrinsics 返回的 `Vec<Extrinsic>` 不能 decode，为了解耦，可以返回 `Vec<EncodedExtrinsic>`

6. [Add metadata dump subcommand #10418](https://github.com/paritytech/substrate/issues/10418) 社区里需不需要加导出 metadata 的命令的讨论

7. [Ability to charge extra fee for operational transaction to prevent spam #10424](https://github.com/paritytech/substrate/issues/10424) 增加费用来防止无用交易

8. [Proposal: include metadata hash into signed payload #10478](https://github.com/paritytech/substrate/issues/10478) 在签名加入 metadata 的 hash，防止恶意更新

9. [Pre-Charge max size when contracts access storage #10508](https://github.com/paritytech/substrate/issues/10508) 原先是读取 storage 在一定时间，但并不一定能读取，这里可以根据 gas 预读取最大长度，再根据真实长度返还 gas。



## 文档和资料

* [Substrate Seminar: Aleph — a New Finality Gadget for Substrate Chains](https://www.youtube.com/watch?v=jIy0gzTLBus)  这期由 aleph zero 的 aleph 带来异步拜占庭容错共识，主要介绍了 aleph 和官方 GRANDPA 的区别

* [The Parachain Advantage: Exploring Polkadot's Next-Generation Mode](https://polkadot.network/blog/the-parachain-advantage-exploring-polkadots-next-generation-model/)  主要介绍平行链优势，形式，如何拍卖和众贷


* [Statemint Becomes First Common Good Parachain on Polkadot](https://polkadot.network/blog/statemint-becomes-first-common-good-parachain-on-polkadot/) 官方主要介绍了 statemint 和生态


## 技术生态和社区

* [Substrate Saturday 第4期回放：基于Substrate 的智能合约实现](https://mp.weixin.qq.com/s/b67vKj09aaTvdFqS456-lg) 本期我们非常荣幸的邀请到了Moonbeam开发者关系工程师@Henry、Astar中国代表@宋明时来为我们分享基于Substrate的智能合约实现

* [Substrate Saturday 第5期回放：Parity's ink!智能合约概述](https://mp.weixin.qq.com/s/Fxf8bda2siWOdSR89Bu0tg) 本期我们非常荣幸的邀请到了Parity 官方核心工程师 Alexander Theißen、Hernando Castano 来到直播间为我们分享了基于ink的智能合约的概念与实现。

* [《Substrate区块链开发进阶课》第四期开启报名](https://mp.weixin.qq.com/s/OAOLuSQwgppm2VtBZv9veA) Moonbeam课程结课，substrate 第四期课程开始

* [Parachains are Live! Polkadot Launch is Now Complete](https://polkadot.network/blog/parachains-are-live-polkadot-launch-is-now-complete/) 平行链上线了，和路线图


## 跨链协议

* [XCM Generics Benchmarks Leftovers (TODO)](https://github.com/paritytech/polkadot/issues/4426) XCM 基准测试 TODO 列表

* [Avoid trap asset amount below a threshold #4425](https://github.com/paritytech/polkadot/issues/4425) 避免跨链的灰尘交易，可以直接抛弃









 
